<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>user media</title>
</head>

<body>

<section id="app" hidden>
	<video id="show" autoplay></video>
</section>

<script>
var video = document.getElementById("show");
var app = document.getElementById("app");

if (navigator.mediaDevices === undefined) {
      navigator.mediaDevices = {};
}
if (navigator.mediaDevices.getUserMedia === undefined) {
    navigator.mediaDevices.getUserMedia = function(constraints) {
        var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        if (!getUserMedia) {
            alert('没有这个方法');
            return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
        }
        return new Promise(function(resolve, reject) {
            getUserMedia.call(navigator, constraints, resolve, reject);
        })
    }
}

function init(){
	navigator.mediaDevices.getUserMedia({ audio: true, video: true }).then(function(steam) {
        var video = document.querySelector('video');
        try {
            video.srcObject = stream;
        } catch(e) {
            video.src = window.URL.createObjectURL(stream);
        }
        video.onloadedmetadata = function(e) {
            video.play();
        };
    }).catch(function(err) {
        alert('失败: ' + err.name + ": " + err.message);
    });
}
init();
</script>

</script>
</body>
</html>
